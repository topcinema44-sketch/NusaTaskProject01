<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NusaTask ‚Ä¢ Earning</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg1:#0f172a; --bg2:#1e293b;
  --pri1:#6366f1; --pri2:#4f46e5;
  --sec1:#22c55e; --sec2:#16a34a;
}
body{margin:0;font-family:'Poppins',sans-serif;color:#fff;
  background:radial-gradient(1200px 1200px at 10% -10%,#1f2445 0,#121827 45%),
             linear-gradient(135deg,var(--bg1),var(--bg2));
}
.topbar{position:fixed;top:0;left:0;right:0;z-index:20;
  display:flex;align-items:center;gap:10px;
  padding:12px 16px;background:rgba(0,0,0,.25);backdrop-filter: blur(6px);}
.avatar{width:28px;height:28px;border-radius:50%;background:#20293a;display:grid;place-items:center}
.avatar::after{content:"üë§"}
.user-email{font-size:13px;color:#d1d5db;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:70vw}
.wrap{max-width:700px;margin:90px auto 40px;padding:0 16px}
.card{background:#0c1220;border:1px solid rgba(255,255,255,.08);
  border-radius:16px;padding:22px;text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,.35);}
.saldo{font-size:26px;font-weight:700;margin-bottom:20px}
.btn{display:block;width:100%;margin:10px 0;padding:15px;border:0;
  border-radius:12px;font-size:16px;font-weight:600;color:#fff;cursor:pointer;transition:.2s}
.btn:disabled{opacity:.6;cursor:not-allowed}
.btn-pri{background:linear-gradient(90deg,var(--pri1),var(--pri2))}
.btn-sec{background:linear-gradient(90deg,var(--sec1),var(--sec2))}
.progress{height:6px;background:#1e293b;border-radius:10px;overflow:hidden;margin-top:4px}
.progress span{display:block;height:100%;background:#22c55e;width:0%;transition:width 0.3s}
.bannedOverlay{position:fixed;top:0;left:0;right:0;bottom:0;
  background:rgba(0,0,0,.85);color:#fff;display:none;z-index:999;
  justify-content:center;align-items:center;text-align:center;padding:20px}
</style>
</head>
<body>

<div class="topbar"><div class="avatar"></div><div class="user-email" id="miniEmail">Memuat‚Ä¶</div></div>
<div class="wrap">

  <!-- login -->
  <div class="card" id="authCard">
    <h2>Masuk / Daftar</h2>
    <input id="email" class="btn" style="background:#1e293b;color:#fff;margin-top:12px" type="email" placeholder="Email">
    <input id="password" class="btn" style="background:#1e293b;color:#fff" type="password" placeholder="Password (min 6)">
    <button id="btnLogin" class="btn btn-pri">Masuk</button>
    <button id="btnRegister" class="btn btn-sec">Daftar</button>
  </div>

  <!-- earning -->
  <div class="card" id="earnCard" style="display:none">
    <div class="saldo" id="saldo">Saldo: Rp 0</div>

    <button id="btnEarn" class="btn btn-pri">MENGHASILKAN</button>
    <div class="progress"><span id="progEarn"></span></div>

    <button id="btnBonus" class="btn btn-sec">XSTRA BONUS</button>
    <div class="progress"><span id="progBonus"></span></div>

    <p style="font-size:13px;color:#f87171;margin-top:16px">‚ö†Ô∏è Segala bentuk kecurangan (tuyul, hack, clone) akan <b>diblokir permanen</b>.<br/>
    Jika akun terblokir, hubungi <a href="https://t.me/nusataskproject" style="color:#60a5fa">Admin Telegram</a></p>
  </div>
</div>

<!-- banned overlay -->
<div class="bannedOverlay" id="bannedCard">
  <div>
    <h2>üö´ Akun Anda Diblokir</h2>
    <p>Hubungi admin di <a href="https://t.me/nusataskproject" style="color:#60a5fa">t.me/nusataskproject</a></p>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<!-- Monetag SDK -->
<script src='//libtl.com/sdk.js' data-zone='9779635' data-sdk='show_9779635'></script>
<!-- FingerprintJS -->
<script src="https://openfpcdn.io/fingerprintjs/v3"></script>

<script>
const firebaseConfig={apiKey:"AIzaSyAUcac_uXdofDbqPwltgb4m7qIPiQhJi0s",
authDomain:"nusataskproject.firebaseapp.com",
databaseURL:"https://nusataskproject-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"nusataskproject",storageBucket:"nusataskproject.firebasestorage.app",
messagingSenderId:"409602188456",appId:"1:409602188456:web:6302d3030b763324e28e9d",
measurementId:"G-9389QL1WRE"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database();

let deviceId=""; const CD_MS=180000, REWARD_EARN=30000, REWARD_BONUS=15000, MAX_EARN=25, MAX_BONUS=30;
function $(id){return document.getElementById(id);}
function resetKeyWIB(){return new Date().toLocaleDateString("id-ID",{timeZone:"Asia/Jakarta"});}

// init fingerprint
FingerprintJS.load().then(fp=>fp.get()).then(res=>{deviceId=res.visitorId;});

// auth buttons
$("btnLogin").onclick=()=>auth.signInWithEmailAndPassword($("email").value,$("password").value).catch(e=>alert(e.message));
$("btnRegister").onclick=()=>auth.createUserWithEmailAndPassword($("email").value,$("password").value).then(()=>{}).catch(e=>alert(e.message));

// anti tuyul
async function antiTuyulCheck(user){
  const refUser=db.ref("users/"+user.uid);
  const ip= (await (await fetch("https://api.ipify.org?format=json")).json()).ip;

  const devRef=db.ref("devices/"+deviceId);
  const devSnap=await devRef.once("value");
  if(devSnap.exists() && devSnap.val()!==user.uid){
    await refUser.update({banned:true,reason:"Multi akun di device"});return false;
  }
  const ipRef=db.ref("ips/"+ip);
  const ipSnap=await ipRef.once("value"); let data=ipSnap.val()||{};
  let now=Date.now(),count=0;for(let k in data){if(now-data[k]<86400000)count++;}
  if(count>=2 && !data[user.uid]){
    await refUser.update({banned:true,reason:">2 akun di IP"});return false;
  }
  await devRef.set(user.uid); await ipRef.child(user.uid).set(now);
  await refUser.update({deviceId,ip});
  return true;
}

auth.onAuthStateChanged(async user=>{
  if(!user){$("authCard").style.display="block";$("earnCard").style.display="none";$("bannedCard").style.display="none";$("miniEmail").textContent="Belum login";return;}
  const ref=db.ref("users/"+user.uid);
  const snap=await ref.once("value"); let data=snap.val();
  if(!data){await ref.set({email:user.email,saldo:0,banned:false,earning:{menghasilkan:{},bonus:{}}});}
  const ok=await antiTuyulCheck(user);
  if(!ok||data?.banned){$("authCard").style.display="none";$("earnCard").style.display="none";$("bannedCard").style.display="flex";$("miniEmail").textContent=user.email;return;}
  $("authCard").style.display="none";$("earnCard").style.display="block";$("bannedCard").style.display="none";$("miniEmail").textContent=user.email;
  db.ref("users/"+user.uid+"/saldo").on("value",s=>{$("saldo").textContent="Saldo: Rp "+(s.val()||0);});
});

// tombol menghasilkan
$("btnEarn").onclick=()=> {
  const u=auth.currentUser;if(!u)return;
  checkAndReward("menghasilkan",REWARD_EARN,MAX_EARN,"progEarn",()=> {
    show_9779635().then(()=>{ commitReward("menghasilkan",REWARD_EARN,"progEarn"); })
    .catch(()=>alert("Iklan gagal ditampilkan"));
  });
};
// tombol bonus
$("btnBonus").onclick=()=> {
  const u=auth.currentUser;if(!u)return;
  checkAndReward("bonus",REWARD_BONUS,MAX_BONUS,"progBonus",()=> {
    commitReward("bonus",REWARD_BONUS,"progBonus");
  });
};

async function checkAndReward(type,reward,max,progId,onReady){
  const u=auth.currentUser;const ref=db.ref("users/"+u.uid+"/earning/"+type);
  const snap=await ref.once("value");let d=snap.val()||{count:0,lastClick:0,lastReset:resetKeyWIB()};
  if(d.lastReset!==resetKeyWIB()){d.count=0;d.lastReset=resetKeyWIB();}
  if(d.count>=max){alert("üö´ Limit harian habis");return;}
  const remain=CD_MS-(Date.now()-(d.lastClick||0));
  if(remain>0){updateProgress(remain,progId);return;}
  onReady();
}
async function commitReward(type,reward,progId){
  const u=auth.currentUser;if(!u)return;
  const baseRef=db.ref("users/"+u.uid);const actRef=baseRef.child("earning/"+type);
  const snap=await actRef.once("value");let d=snap.val()||{count:0,lastClick:0,lastReset:resetKeyWIB()};
  await baseRef.update({
    saldo:firebase.database.ServerValue.increment(reward),
    ["earning/"+type+"/count"]:(d.count||0)+1,
    ["earning/"+type+"/lastClick"]:firebase.database.ServerValue.TIMESTAMP,
    ["earning/"+type+"/lastReset"]:resetKeyWIB()
  });
  updateProgress(CD_MS,progId);
}
function updateProgress(ms,id){
  let span=$(id);let total=CD_MS;let end=Date.now()+ms;
  function step(){let remain=end-Date.now();if(remain<0)remain=0;let percent=100-(remain/total*100);span.style.width=percent+"%";if(remain>0)requestAnimationFrame(step);}
  step();
}
</script>
</body>
</html>