<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Penghasil Uang</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hidden{display:none}
    body.dark{background:#0b1220}
    .fade-in {animation: fadein .4s ease}
    @keyframes fadein {from{opacity:0;transform:scale(.97)} to{opacity:1;transform:scale(1)}}
  </style>
</head>
<body class="bg-gray-50 dark:bg-slate-900 text-gray-800 dark:text-slate-100 min-h-screen">

  <!-- TOAST -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 z-50 px-4 py-2 rounded-lg bg-gray-900 text-white text-sm shadow-lg hidden"></div>

  <main class="max-w-md mx-auto p-4">

    <!-- ===== AUTH SECTION ===== -->
    <section id="authSection" class="space-y-5 fade-in">
      <h1 class="text-center text-2xl font-bold">ğŸ” Masuk / Daftar</h1>

      <!-- Banner atas -->
      <div class="grid grid-cols-2 gap-2">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+Banner+A" class="w-full rounded-lg shadow" alt="">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+Banner+B" class="w-full rounded-lg shadow" alt="">
      </div>

      <!-- Tabs -->
      <div class="flex rounded-xl overflow-hidden border dark:border-slate-700">
        <button id="btnLoginTab" class="flex-1 py-2 bg-blue-600 text-white font-medium">Login</button>
        <button id="btnRegisterTab" class="flex-1 py-2 bg-gray-200 dark:bg-slate-800">Register</button>
      </div>

      <!-- Login Form -->
      <div id="loginForm" class="space-y-3 fade-in">
        <input id="loginEmail" type="email" placeholder="Email" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
        <input id="loginPassword" type="password" placeholder="Password" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
        <button id="btnLogin" class="w-full py-3 rounded-xl bg-blue-600 text-white font-semibold">Login</button>
      </div>

      <!-- Register Form -->
      <div id="registerForm" class="space-y-3 hidden fade-in">
        <input id="registerEmail" type="email" placeholder="Email" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
        <input id="registerPassword" type="password" placeholder="Password (min 6)" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
        <input id="registerUsername" type="text" placeholder="Username Telegram" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
        <button id="btnRegister" class="w-full py-3 rounded-xl bg-emerald-600 text-white font-semibold">Register</button>
      </div>

      <!-- Banner bawah -->
      <div class="grid grid-cols-2 gap-2">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+Banner+C" class="w-full rounded-lg shadow" alt="">
        <img src="https://via.placeholder.com/300x80?text=Hiltoads+Banner+D" class="w-full rounded-lg shadow" alt="">
      </div>
    </section>

    <!-- ===== MAIN SECTION ===== -->
    <section id="mainSection" class="hidden space-y-5 fade-in">
      <!-- Header -->
      <header class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <img id="userPhoto" src="https://i.pravatar.cc/80" class="w-10 h-10 rounded-full ring-2 ring-white/50" alt="avatar">
          <div class="text-sm">
            <div class="font-semibold leading-tight" id="userName">User</div>
            <div class="text-gray-500 dark:text-slate-400 text-xs">Aktif</div>
          </div>
        </div>
        <div class="text-right">
          <div class="text-xs text-gray-500 dark:text-slate-400">Saldo</div>
          <div class="text-lg font-extrabold text-emerald-500" id="saldoLabel">Rp 0</div>
          <div id="harianLabel" class="text-[11px] text-gray-500 dark:text-slate-400"></div>
        </div>
      </header>

      <!-- Actions -->
      <div class="grid gap-3">
        <button id="btnMonetag" class="w-full py-4 rounded-2xl bg-blue-600 text-white font-semibold shadow active:opacity-90">ğŸ“º Klik Iklan Monetag (+Rp30.000)</button>
        <div id="timerMonetag" class="text-center text-xs text-gray-600 dark:text-slate-400"></div>

        <button id="btnToHiltoads" class="w-full py-4 rounded-2xl bg-purple-600 text-white font-semibold shadow active:opacity-90">ğŸ¯ Tugas Hiltoads (+Rp30.000)</button>
        <div id="timerHiltoads" class="text-center text-xs text-gray-600 dark:text-slate-400"></div>
      </div>

      <!-- Withdraw -->
      <section class="space-y-3">
        <h3 class="font-bold">Withdraw</h3>
        <div class="grid grid-cols-2 gap-3">
          <select id="walletType" class="p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800">
            <option value="Dana">Dana</option>
            <option value="OVO">OVO</option>
            <option value="GoPay">GoPay</option>
            <option value="ShopeePay">ShopeePay</option>
          </select>
          <input id="walletNumber" type="tel" placeholder="Nomor e-wallet" class="p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800" />
        </div>
        <input id="wdAmount" type="number" min="30000" step="1000" value="30000" class="w-full p-3 rounded-lg border dark:border-slate-700 dark:bg-slate-800" />
        <button id="btnWD" class="w-full py-3 rounded-xl bg-emerald-600 text-white font-semibold">Ajukan WD (Min Rp30.000)</button>
        <button id="btnRiwayatPage" class="w-full py-2 rounded-lg bg-gray-200 dark:bg-slate-800 text-sm">ğŸ“œ Lihat Riwayat WD</button>
      </section>

      <!-- Footer -->
      <footer class="flex items-center justify-between pt-4 border-t dark:border-slate-800">
        <button id="btnTheme" class="px-3 py-2 rounded-lg bg-gray-200 dark:bg-slate-800">ğŸŒ— Tema</button>
        <div class="flex items-center gap-2">
          <button onclick="window.open('https://t.me/nusataskproject','_blank')" class="px-3 py-2 rounded-lg bg-blue-600 text-white">Help</button>
          <button disabled class="px-3 py-2 rounded-lg bg-red-500 text-white opacity-60">YouTube</button>
          <button disabled class="px-3 py-2 rounded-lg bg-pink-500 text-white opacity-60">Instagram</button>
        </div>
      </footer>
    </section>

    <!-- ===== RIWAYAT SECTION ===== -->
    <section id="riwayatSection" class="hidden space-y-4 fade-in">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold">ğŸ“œ Riwayat WD</h3>
        <button id="btnBackMain" class="px-3 py-2 rounded-lg bg-gray-300 dark:bg-slate-800">â¬…ï¸ Kembali</button>
      </div>
      <ul id="riwayatWd" class="space-y-2 text-sm"></ul>
    </section>

    <!-- ===== HILTOADS SECTION ===== -->
    <section id="hiltoadsSection" class="hidden space-y-4 fade-in">
      <div class="flex items-center justify-between">
        <h3 class="text-xl font-bold">Iklan Hiltoads</h3>
        <button id="btnBackHiltoads" class="px-3 py-2 rounded-lg bg-gray-300 dark:bg-slate-800" disabled>â³ Tunggu 5 dtk...</button>
      </div>
      <div class="grid gap-3">
        <img src="https://via.placeholder.com/600x150?text=Hiltoads+Banner+1" class="w-full rounded-xl shadow" alt="">
        <img src="https://via.placeholder.com/600x150?text=Hiltoads+Banner+2" class="w-full rounded-xl shadow" alt="">
        <img src="https://via.placeholder.com/600x150?text=Hiltoads+Banner+3" class="w-full rounded-xl shadow" alt="">
        <img src="https://via.placeholder.com/600x150?text=Hiltoads+Banner+4" class="w-full rounded-xl shadow" alt="">
        <img src="https://via.placeholder.com/600x150?text=Hiltoads+Banner+5" class="w-full rounded-xl shadow" alt="">
      </div>
      <p class="text-xs text-gray-500 dark:text-slate-400">Tunggu 5 detik sebelum tombol kembali aktif. Reward akan ditambahkan bila tidak sedang cooldown (10 menit).</p>
    </section>

  </main>

  <!-- ===== Script Firebase + App ===== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, where, onSnapshot, serverTimestamp, runTransaction, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = { /* pakai config kamu */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const TELEGRAM_BOT_TOKEN = "8236562243:AAFIyLCk2fu9-4GxxYSuIoSKw9DEiv1DVko";
    const TELEGRAM_CHAT_ID = "8322802091";

    const $=id=>document.getElementById(id);
    const show=el=>el.classList.remove("hidden");
    const hide=el=>el.classList.add("hidden");
    const toast=msg=>{const t=$("toast");t.textContent=msg;t.classList.remove("hidden");setTimeout(()=>t.classList.add("hidden"),2600)};
    const formatRp=n=>"Rp "+(n||0).toLocaleString("id-ID");

    // Tabs login/register
    $("btnLoginTab").onclick=()=>{show($("loginForm"));hide($("registerForm"))};
    $("btnRegisterTab").onclick=()=>{hide($("loginForm"));show($("registerForm"))};

    // Auth actions
    $("btnLogin").onclick=async()=>{try{await signInWithEmailAndPassword(auth,$("loginEmail").value,$("loginPassword").value);toast("âœ… Login sukses");}catch(e){toast("âŒ "+e.message)}};
    $("btnRegister").onclick=async()=>{try{
      const email=$("registerEmail").value; const pass=$("registerPassword").value; const uname=$("registerUsername").value||"User";
      const cred=await createUserWithEmailAndPassword(auth,email,pass);
      await setDoc(doc(db,"users",cred.user.uid),{email,username:uname,saldo:0,monetagCount:0,lastMonetag:null,lastHiltoads:null});
      toast("âœ… Registrasi sukses");
    }catch(e){toast("âŒ "+e.message)}};

    // Theme
    $("btnTheme").onclick=()=>{const dark=document.body.classList.toggle("dark");localStorage.setItem("theme",dark?"dark":"light")};
    if(localStorage.getItem("theme")==="dark")document.body.classList.add("dark");

    // Auth state
    let currentUser=null,userDocRef=null;
    onAuthStateChanged(auth,async(user)=>{if(user){currentUser=user;userDocRef=doc(db,"users",user.uid);hide($("authSection"));show($("mainSection"));bindUserSnapshot();}else{show($("authSection"));hide($("mainSection"));hide($("hiltoadsSection"));hide($("riwayatSection"));}});

    function bindUserSnapshot(){onSnapshot(userDocRef,(snap)=>{const d=snap.data()||{};$("userName").textContent=d.username||"User";$("saldoLabel").textContent=formatRp(d.saldo||0)})}

    // Withdraw
    $("btnWD").onclick=async()=>{if(!currentUser)return;const amount=parseInt($("wdAmount").value,10);const walletType=$("walletType").value;const walletNumber=$("walletNumber").value.trim();if(!walletNumber)return toast("âŒ Masukkan nomor e-wallet");if(amount<30000)return toast("âš ï¸ Minimal Rp30.000");
      let newId="";try{await runTransaction(db,async(trx)=>{const snap=await trx.get(userDocRef);const d=snap.data();if((d.saldo||0)<amount)throw new Error("Saldo tidak cukup");trx.update(userDocRef,{saldo:(d.saldo||0)-amount});const ref=doc(collection(db,"withdrawals"));newId=ref.id;trx.set(ref,{uid:currentUser.uid,email:currentUser.email,amount,walletType,walletNumber,status:"pending",createdAt:serverTimestamp()});});
      fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({chat_id:TELEGRAM_CHAT_ID,text:`ğŸ“¤ WD Baru\nğŸ‘¤ ${currentUser.email}\nğŸ’° ${formatRp(amount)}\nğŸ§ ${walletType}: ${walletNumber}\nğŸ†” ${newId}`})});
      toast("âœ… WD diajukan")}catch(e){toast("âŒ "+e.message)}};

    // Riwayat
    $("btnRiwayatPage").onclick=()=>{hide($("mainSection"));show($("riwayatSection"));bindRiwayat()};
    $("btnBackMain").onclick=()=>{show($("mainSection"));hide($("riwayatSection"))};
    function bindRiwayat(){const q=query(collection(db,"withdrawals"),where("uid","==",currentUser.uid));onSnapshot(q,(snaps)=>{const list=$("riwayatWd");list.innerHTML="";snaps.forEach(s=>{const d=s.data();const li=document.createElement("li");li.className="p-3 rounded-xl bg-white dark:bg-slate-800 border";li.textContent=`${formatRp(d.amount)} - ${d.walletType} (${d.status})`;list.appendChild(li)})})}
  </script>
</body>
</html>
