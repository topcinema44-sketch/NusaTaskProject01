<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NusaTask ‚Ä¢ All in One</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0a0f1a; --bg2:#111827;
    --pri1:#6366f1; --pri2:#4f46e5;
    --sec1:#22c55e; --sec2:#16a34a;
    --text:#e5e7eb; --muted:#9ca3af;
    --warn:#f87171;
  }
  body{
    margin:0; font-family:'Poppins',sans-serif; color:var(--text);
    background:linear-gradient(135deg,var(--bg1),var(--bg2)); min-height:100vh;
  }
  /* splash */
  #splash{
    position:fixed;inset:0;display:flex;flex-direction:column;
    align-items:center;justify-content:center;gap:16px;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    z-index:100;transition:opacity 1s ease;
  }
  #splash img{width:120px;height:120px;opacity:0;animation:fadein 2s forwards}
  @keyframes fadein{to{opacity:1}}
  .spinner{width:32px;height:32px;border:3px solid #444;border-top:3px solid var(--pri1);border-radius:50%;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .progress{width:200px;height:6px;background:#1f2937;border-radius:4px;overflow:hidden}
  .progress-bar{height:100%;width:0;background:var(--pri1);transition:width .3s ease}
  /* top bar */
  .topbar{
    position:fixed;top:0;left:0;right:0;z-index:20;
    display:flex;align-items:center;gap:10px;
    padding:12px 16px;background:rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
  }
  .avatar{width:28px;height:28px;border-radius:50%;background:#1f2937;display:grid;place-items:center}
  .avatar::after{content:"üë§"}
  .user-email{font-size:13px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:70vw}
  /* container */
  .wrap{max-width:700px;margin:90px auto 40px;padding:0 16px}
  .card{
    background:#0d1424;border:1px solid rgba(255,255,255,.06);
    border-radius:18px;padding:24px;text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,.35);margin-bottom:18px;
  }
  h2{margin:0 0 16px}
  .saldo{font-size:28px;font-weight:700;margin-bottom:22px}
  /* input */
  .inpt{
    width:100%;padding:14px;margin:8px 0;border-radius:12px;
    border:1px solid rgba(255,255,255,.08);background:#1e293b;color:var(--text);outline:none
  }
  .btn{
    width:100%;margin:10px 0;padding:15px;border:0;border-radius:12px;
    font-size:16px;font-weight:600;color:#fff;cursor:pointer;transition:.2s;
  }
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .btn-pri{background:linear-gradient(90deg,var(--pri1),var(--pri2))}
  .btn-sec{background:linear-gradient(90deg,var(--sec1),var(--sec2))}
  /* progress earning */
  .progress-wrap{margin-top:6px;text-align:left}
  .progress-task{height:8px;border-radius:6px;background:#1f2937;overflow:hidden}
  .progress-bar-task{height:100%;background:var(--pri1);width:0%;transition:width .4s ease}
  .progress-text{font-size:12px;color:var(--muted);margin-top:3px}
  /* info */
  .warn{font-size:13px;color:var(--warn);margin-top:14px}
  .hint{font-size:13px;color:var(--muted);margin-top:14px}
  /* banned */
  .banned{margin:120px auto;text-align:center;max-width:500px}
  .banned h1{color:var(--warn);font-size:26px}
  .banned a{color:#3b82f6;text-decoration:none;font-weight:600}
  /* toast */
  .toast{
    position:fixed;left:50%;bottom:28px;transform:translateX(-50%);
    background:rgba(17,24,39,.95);color:#e5e7eb;
    border:1px solid rgba(255,255,255,.08);
    padding:10px 14px;border-radius:10px;
    font-size:14px;z-index:50;opacity:0;transition:.4s;
  }
</style>
</head>
<body>

<!-- splash -->
<div id="splash">
  <img src="https://i.ibb.co/m4QvVQJ/logo.png" alt="Logo"/>
  <div class="spinner"></div>
  <div class="progress"><div class="progress-bar" id="splashBar"></div></div>
</div>

<!-- topbar -->
<div class="topbar">
  <div class="avatar"></div>
  <div class="user-email" id="miniEmail">Belum login</div>
</div>

<div class="wrap">
  <!-- login -->
  <div class="card" id="authCard">
    <h2>Masuk / Daftar</h2>
    <input id="email" class="inpt" type="email" placeholder="Email">
    <input id="password" class="inpt" type="password" placeholder="Password (min 6)">
    <button id="btnLogin" class="btn btn-pri">Masuk</button>
    <button id="btnRegister" class="btn btn-sec">Daftar</button>
  </div>

  <!-- earning -->
  <div class="card" id="earnCard" style="display:none">
    <div class="saldo" id="saldo">Saldo: Rp 0</div>

    <!-- menghasilkan -->
    <button id="btnEarn" class="btn btn-pri">MENGHASILKAN</button>
    <div class="progress-wrap">
      <div class="progress-task"><div class="progress-bar-task" id="progEarn"></div></div>
      <div class="progress-text" id="progTextEarn">0 / 25</div>
    </div>

    <!-- bonus -->
    <button id="btnBonus" class="btn btn-sec">XSTRA BONUS</button>
    <div class="progress-wrap">
      <div class="progress-task"><div class="progress-bar-task" id="progBonus"></div></div>
      <div class="progress-text" id="progTextBonus">0 / 30</div>
    </div>

    <p class="warn">‚ö†Ô∏è Siapa saja yang melanggar akan diblokir</p>
    <p class="hint">Jika akun terblokir, hubungi admin <a href="https://t.me/nusataskproject" target="_blank">Telegram</a></p>
  </div>

  <!-- banned -->
  <div class="banned" id="bannedCard" style="display:none">
    <h1>üö´ Akun Anda Diblokir</h1>
    <p>Hubungi admin melalui <a href="https://t.me/nusataskproject" target="_blank">Telegram</a></p>
  </div>
</div>

<!-- toast container -->
<div id="toast"></div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ===== SPLASH CONTROL ===== */
let splashBar=document.getElementById("splashBar");let splash=document.getElementById("splash");
let load=0;let int=setInterval(()=>{load+=10;splashBar.style.width=load+"%";if(load>=100){clearInterval(int);setTimeout(()=>{splash.style.opacity="0";setTimeout(()=>splash.remove(),1000)},500);}},150);

/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAUcac_uXdofDbqPwltgb4m7qIPiQhJi0s",
  authDomain: "nusataskproject.firebaseapp.com",
  databaseURL: "https://nusataskproject-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "nusataskproject",
  storageBucket: "nusataskproject.firebasestorage.app",
  messagingSenderId: "409602188456",
  appId: "1:409602188456:web:6302d3030b763324e28e9d",
  measurementId: "G-9389QL1WRE"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(), db=firebase.database();

/* ===== CONST ===== */
const REWARD_EARN=30000, REWARD_BONUS=30000;
const CD_MS=180000, MAX_EARN=25, MAX_BONUS=30;
function todayKey(){ let d=new Date(Date.now()+7*3600*1000); return d.toISOString().slice(0,10); }

/* ===== DEVICE LOCK ===== */
const deviceId=(()=>{let k="NT_device",d=localStorage.getItem(k);if(!d){d=crypto.randomUUID();localStorage.setItem(k,d);}return d;})();

/* ===== AUTH ===== */
$("btnLogin").onclick=()=>auth.signInWithEmailAndPassword($("email").value,$("password").value).catch(e=>toast(e.message));
$("btnRegister").onclick=()=>auth.createUserWithEmailAndPassword($("email").value,$("password").value).then(c=>db.ref("users/"+c.user.uid).set({
  email:c.user.email,saldo:0,deviceId,banned:false,
  earning:{menghasilkan:{count:0,lastClick:0,lastReset:todayKey()},
           bonus:{count:0,lastClick:0,lastReset:todayKey()}}
})).catch(e=>toast(e.message));

auth.onAuthStateChanged(async user=>{
  if(!user){$("authCard").style.display="block";$("earnCard").style.display="none";$("bannedCard").style.display="none";$("miniEmail").textContent="Belum login";return;}
  const ref=db.ref("users/"+user.uid);
  const snap=await ref.once("value");const data=snap.val();
  if(!data)return;
  if(data.banned){$("authCard").style.display="none";$("earnCard").style.display="none";$("bannedCard").style.display="block";$("miniEmail").textContent=user.email;return;}
  $("authCard").style.display="none";$("earnCard").style.display="block";$("bannedCard").style.display="none";$("miniEmail").textContent=user.email;
  ref.child("saldo").on("value",s=>$("saldo").textContent="Saldo: Rp "+(s.val()||0).toLocaleString("id-ID"));
  const dev=data.deviceId;if(dev&&dev!==deviceId){toast("‚ö†Ô∏è Akun terkunci di device lain!");auth.signOut();return;}
  refreshUI();
});

/* ===== AKSI ===== */
$("btnEarn").onclick=()=>doAction("menghasilkan",REWARD_EARN,MAX_EARN,$("btnEarn"),"MENGHASILKAN");
$("btnBonus").onclick=()=>doAction("bonus",REWARD_BONUS,MAX_BONUS,$("btnBonus"),"XSTRA BONUS");

async function doAction(type,reward,max,btn,label){
  const uid=auth.currentUser.uid,ref=db.ref("users/"+uid+"/earning/"+type);
  const snap=await ref.once("value");let d=snap.val()||{count:0,lastClick:0,lastReset:todayKey()};
  if(d.lastReset!==todayKey()){d.count=0;d.lastReset=todayKey();}
  if(d.count>=max){toast("üö´ Limit harian habis");refreshUI();return;}
  if(Date.now()-(d.lastClick||0)<CD_MS){toast("‚è≥ Masih cooldown");refreshUI();return;}
  db.ref("users/"+uid).update({
    saldo:firebase.database.ServerValue.increment(reward),
    ["earning/"+type+"/count"]:d.count+1,
    ["earning/"+type+"/lastClick"]:firebase.database.ServerValue.TIMESTAMP,
    ["earning/"+type+"/lastReset"]:todayKey()
  });
  window.open(type==="menghasilkan"?"https://example.com/monetag":"https://example.com/klikadila","_blank");
  refreshUI();
}

/* ===== UI ===== */
async function refreshUI(){
  const uid=auth.currentUser.uid;
  const e=(await db.ref("users/"+uid+"/earning/menghasilkan").once("value")).val()||{};
  const b=(await db.ref("users/"+uid+"/earning/bonus").once("value")).val()||{};
  setBtn($("btnEarn"),"MENGHASILKAN",e,MAX_EARN,$("progEarn"),$("progTextEarn"));
  setBtn($("btnBonus"),"XSTRA BONUS",b,MAX_BONUS,$("progBonus"),$("progTextBonus"));
}
function setBtn(btn,label,d,max,bar,text){
  if(!d){btn.textContent=label;btn.disabled=false;return;}
  if(d.count>=max){btn.textContent=label+" (Limit)";btn.disabled=true;}
  let remain=CD_MS-(Date.now()-(d.lastClick||0));
  if(remain>0){btn.disabled=true;countdown(btn,label,remain);}
  else if(d.count<max){btn.disabled=false;btn.textContent=label;}
  let progress=Math.min(100,(d.count||0)/max*100);
  bar.style.width=progress+"%";
  text.textContent=(d.count||0)+" / "+max;
}
function countdown(btn,label,ms){
  let end=Date.now()+ms;
  const tick=()=>{let s=Math.max(0,Math.ceil((end-Date.now())/1000));btn.textContent=`${label} (${s}s)`;if(s<=0){btn.textContent=label;btn.disabled=false;clearInterval(t);} };
  tick();let t=setInterval(tick,1000);
}
function $(id){return document.getElementById(id);}

/* ===== TOAST ===== */
function toast(msg){
  const d=document.createElement("div");
  d.className="toast";d.textContent=msg;
  document.body.appendChild(d);
  setTimeout(()=>{d.style.opacity="1"},10);
  setTimeout(()=>{d.style.opacity="0"},2000);
  setTimeout(()=>d.remove(),2500);
}
</script>
</body>
</html>