<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bot Earning â€” Pro</title>
  <meta name="theme-color" content="#0b0f1a" />
  <style>
    :root{
      --bg:#0b0f1a; --card:#0f172a; --muted:#8ea0c8; --text:#eaf1ff;
      --primary:#5b8cff; --primary-2:#355bff; --accent:#22d3ee;
      --danger:#ef4444; --ok:#22c55e; --ring:rgba(91,140,255,.35);
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(1200px 600px at 80% -20%, rgba(34,211,238,.08), transparent 60%),
        radial-gradient(900px 500px at -10% 120%, rgba(91,140,255,.08), transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:640px;margin:0 auto;padding:18px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:34px;height:34px;border-radius:10px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      box-shadow:0 10px 30px rgba(91,140,255,.35), inset 0 0 20px rgba(255,255,255,.15);
      animation:float 6s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.00));
      border:1px solid rgba(148,163,184,.15);
      border-radius:18px; padding:18px; margin:14px 0;
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px rgba(2,6,23,.6);
      animation:fadeIn .25s ease;
    }
    @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}}
    h1{font-size:20px;margin:0} h2{font-size:18px;margin:0 0 10px}
    .muted{color:var(--muted);font-size:14px}
    input{
      width:100%; padding:12px 14px; margin:8px 0;
      background:rgba(15,23,42,.7); color:var(--text);
      border:1px solid rgba(148,163,184,.2); border-radius:12px;
      outline:none; transition:.2s;
    }
    input:focus{border-color:var(--primary); box-shadow:0 0 0 6px var(--ring)}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .stack>*{display:block;margin:10px 0}
    button{
      position:relative; width:100%; padding:13px 14px; border:0; border-radius:14px;
      background:linear-gradient(180deg,var(--primary),var(--primary-2));
      color:#fff; font-weight:700; letter-spacing:.2px; cursor:pointer;
      transition: transform .08s ease, box-shadow .2s ease, filter .2s ease;
      box-shadow:0 10px 20px rgba(53,91,255,.35); overflow:hidden; user-select:none;
    }
    button:active{transform:translateY(1px)} button[disabled]{opacity:.55; cursor:not-allowed; box-shadow:none; filter:grayscale(.2)}
    .btn-ok{background:linear-gradient(180deg,#22c55e,#16a34a)} .ghost{background:transparent;border:1px dashed rgba(148,163,184,.25);color:var(--muted); box-shadow:none; font-weight:600;}
    button::after{
      content:""; position:absolute; left:var(--x,50%); top:var(--y,50%);
      width:0;height:0;border-radius:999px;background:#fff;opacity:.4;transform:translate(-50%,-50%);
      transition:width .45s ease,height .45s ease,opacity .6s ease;
    }
    button.ripple::after{width:240px;height:240px;opacity:0}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;background:rgba(91,140,255,.15);border:1px solid rgba(91,140,255,.35);}
    .toasts{position:fixed; right:16px; bottom:16px; display:flex; flex-direction:column; gap:10px; z-index:50}
    .toast{
      min-width:220px; max-width:320px; padding:12px 14px; border-radius:12px;
      background:rgba(15,23,42,.95); border:1px solid rgba(148,163,184,.2);
      box-shadow:0 10px 30px rgba(2,6,23,.7);
      transform:translateY(10px); opacity:0; animation:toast-in .18s ease forwards;
    }
    .toast.ok{border-color:rgba(34,197,94,.45)} .toast.warn{border-color:rgba(234,179,8,.45)} .toast.err{border-color:rgba(239,68,68,.45)}
    @keyframes toast-in{to{transform:translateY(0);opacity:1}}
    .balance{
      font-size:26px; font-weight:900;
      background:linear-gradient(90deg,#fff, #9cc2ff, #fff);
      -webkit-background-clip:text; background-clip:text; color:transparent;
      background-size:200% 100%; animation:shine 2.5s linear infinite;
    }
    @keyframes shine{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .ads{display:block;text-align:center;padding:10px;border-radius:12px;border:1px dashed rgba(148,163,184,.25);color:#a7c3ff;text-decoration:none}
    .warning{background:linear-gradient(180deg, rgba(255,225,0,.06), rgba(255,225,0,.00)); border-color:rgba(234,179,8,.35)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>Bot Earning â€” Pro</h1>
        <div class="muted">Dark UI â€¢ Live saldo â€¢ Cooldown persist â€¢ Notif profesional</div>
      </div>
    </div>

    <!-- AUTH -->
    <div id="authCard" class="card">
      <h2>Login / Register</h2>
      <form id="authForm" class="stack" autocomplete="on">
        <input type="email" id="email" inputmode="email" placeholder="Email" required />
        <input type="password" id="pass" placeholder="Password" required />
        <div class="row">
          <button id="btnLogin" type="submit">Masuk</button>
          <button id="btnRegister" type="button" class="btn-ok">Daftar</button>
        </div>
        <div class="muted">Sekali daftar â†’ langsung auto-login.</div>
      </form>
    </div>

    <!-- WARNING (5s before continue) -->
    <div id="warnCard" class="card warning" style="display:none">
      <h2>Peringatan</h2>
      <ul class="muted">
        <li>Satu akun per pengguna. Aktivitas mencurigakan diblokir.</li>
        <li>IP saat pendaftaran dicatat (pindah jaringan diperbolehkan).</li>
        <li>Kecurangan/otomasi tanpa izin akan dibatasi.</li>
      </ul>
      <button id="btnContinue" disabled>Continue (5)</button>
      <div class="muted" style="margin-top:6px">Tunggu 5 detik, lalu lanjut ke dashboard.</div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashCard" class="card" style="display:none">
      <div class="row">
        <div>
          <div class="muted">Akun</div>
          <div id="userEmail">-</div>
        </div>
        <div class="pill" id="ipChip">IP: -</div>
      </div>
      <hr style="border-color:rgba(148,163,184,.15);margin:14px 0" />
      <div class="row" style="align-items:flex-end">
        <div>
          <div class="muted">Saldo</div>
          <div id="saldo" class="balance">Rp 0</div>
        </div>
        <button id="btnLogout" class="ghost" style="width:auto;padding:10px 14px">Keluar</button>
      </div>

      <!-- Buttons vertical -->
      <div class="stack" style="margin-top:10px">
        <button id="btnEarn" data-label="Menghasilkan (+Rp30.000)">Menghasilkan (+Rp30.000)</button>
        <a id="slotMonetag" class="ads" href="#" target="_blank" rel="noopener">[Slot Monetag]</a>

        <button id="btnBonus1" data-label="Xstra Bonus 1 (+Rp30.000)">Xstra Bonus 1 (+Rp30.000)</button>
        <a id="slotKlik1" class="ads" href="#" target="_blank" rel="noopener">[Slot KlikAdilla 1]</a>

        <button id="btnBonus2" data-label="Xstra Bonus 2 (+Rp30.000)">Xstra Bonus 2 (+Rp30.000)</button>
        <a id="slotKlik2" class="ads" href="#" target="_blank" rel="noopener">[Slot KlikAdilla 2]</a>
      </div>

      <div class="muted" style="margin-top:8px">Cooldown 3 menit per tombol â€¢ Tetap berjalan meski halaman di-refresh.</div>
    </div>
  </div>

  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
    import { getDatabase, ref, onValue, get, set, update, runTransaction, child } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // === CONFIG KAMU ===
    const firebaseConfig = {
      apiKey: "AIzaSyAUcac_uXdofDbqPwltgb4m7qIPiQhJi0s",
      authDomain: "nusataskproject.firebaseapp.com",
      projectId: "nusataskproject",
      storageBucket: "nusataskproject.firebasestorage.app",
      messagingSenderId: "409602188456",
      appId: "1:409602188456:web:6302d3030b763324e28e9d",
      measurementId: "G-9389QL1WRE",
      databaseURL: "https://nusataskproject-default-rtdb.firebaseio.com"  <!-- pastikan URL RTDB aktif -->
    };

    // === ADS LINKS (GANTI DENGAN IKLANMU) ===
    const MONETAG_URL = "https://example-monetag.com/campaign"; // GANTI
    const KLIK1_URL  = "https://example-klikadila.com/camp-1";  // GANTI
    const KLIK2_URL  = "https://example-klikadila.com/camp-2";  // GANTI
    document.getElementById("slotMonetag").href = MONETAG_URL;
    document.getElementById("slotKlik1").href   = KLIK1_URL;
    document.getElementById("slotKlik2").href   = KLIK2_URL;

    // === CONST ===
    const REWARD = 30000;
    const COOLDOWN_MS = 3*60*1000; // 3 menit
    const CONTINUE_WAIT_MS = 5000; // 5 detik
    const fmtIDR = n => new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(n);

    // === INIT ===
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const fs   = getFirestore(app);
    const rtdb = getDatabase(app);

    // === UI elts ===
    const authCard = document.getElementById('authCard');
    const warnCard = document.getElementById('warnCard');
    const dashCard = document.getElementById('dashCard');
    const authForm = document.getElementById('authForm');
    const btnLogin = document.getElementById('btnLogin');
    const btnRegister = document.getElementById('btnRegister');
    const btnLogout = document.getElementById('btnLogout');
    const emailEl = document.getElementById('email');
    const passEl  = document.getElementById('pass');
    const userEmailEl = document.getElementById('userEmail');
    const ipChip = document.getElementById('ipChip');
    const saldoEl = document.getElementById('saldo');
    const btnEarn = document.getElementById('btnEarn');
    const btnBonus1 = document.getElementById('btnBonus1');
    const btnBonus2 = document.getElementById('btnBonus2');
    const btnContinue = document.getElementById('btnContinue');
    const toasts = document.getElementById('toasts');

    // Toast
    function toast(msg,type='ok'){
      const t = document.createElement('div');
      t.className = `toast ${type}`; t.innerHTML = msg;
      toasts.appendChild(t);
      setTimeout(()=>{ t.style.opacity=.0; t.style.transform='translateY(6px)'; }, 2200);
      setTimeout(()=> t.remove(), 2700);
      if(navigator.vibrate) navigator.vibrate(10);
    }
    // Ripple
    function attachRipple(btn){
      btn.addEventListener('click', e=>{
        const rect = btn.getBoundingClientRect();
        btn.style.setProperty('--x', `${e.clientX-rect.left}px`);
        btn.style.setProperty('--y', `${e.clientY-rect.top}px`);
        btn.classList.remove('ripple'); void btn.offsetWidth; btn.classList.add('ripple');
      });
    }
    [btnLogin,btnRegister,btnLogout,btnEarn,btnBonus1,btnBonus2,btnContinue].forEach(b=>b&&attachRipple(b));

    // IP helper
    async function getPublicIP(){
      try{ const r=await fetch("https://api.ipify.org?format=json"); const j=await r.json(); return j.ip||"-"; }
      catch{ return "-"; }
    }

    // Cooldown label
    function setCooldownUI(btn, msLeft){
      const base = btn.dataset.label;
      if(msLeft<=0){ btn.disabled=false; btn.textContent=base; }
      else{
        btn.disabled=true;
        const s = Math.ceil(msLeft/1000); const m = Math.floor(s/60), r = s%60;
        btn.textContent = `${base} (tunggu ${m>0? m+"m "+r+"s": r+"s"})`;
      }
    }

    // Auth handlers
    authForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      try{
        await signInWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value);
        toast("Login berhasil. Selamat datang ðŸ‘‹","ok");
      }catch(err){ toast("Login gagal: "+err.message,"err"); }
    });
    btnRegister.addEventListener("click", async ()=>{
      try{
        await createUserWithEmailAndPassword(auth, emailEl.value.trim(), passEl.value);
        toast("Registrasi sukses. Menyiapkan akunâ€¦","ok");
      }catch(err){ toast("Registrasi gagal: "+err.message,"err"); }
    });
    btnLogout.addEventListener("click", async ()=>{ await signOut(auth); toast("Kamu telah keluar.","ok"); });

    // Ensure profile (Firestore) + setup RTDB nodes
    async function ensureProfile(u){
      const uref = doc(fs,"users",u.uid);
      const usnap = await getDoc(uref);
      const ip = await getPublicIP();

      if(!usnap.exists()){
        await setDoc(uref,{
          email: u.email, role:"user", balance:0,
          createdAt: serverTimestamp(), signupIp: ip, lastIp: ip,
          warnedOnce:false
        });
      }else{
        const d = usnap.data();
        if(d.lastIp !== ip) await updateDoc(uref,{ lastIp: ip });
      }

      // RTDB: balance & cooldown defaults
      const balRef = ref(rtdb, `balances/${u.uid}`);
      const cdRef  = ref(rtdb, `cooldowns/${u.uid}`);
      const balSnap = await get(balRef);
      if(!balSnap.exists()) await set(balRef, 0);
      const cdSnap = await get(cdRef);
      if(!cdSnap.exists()) await set(cdRef, { earn:0, bonus1:0, bonus2:0 });

      return ip;
    }

    // Show warning (5s)
    function showWarning(onDone){
      warnCard.style.display='block'; dashCard.style.display='none';
      btnContinue.disabled = true;
      let start = Date.now();
      const timer = setInterval(()=>{
        const left = CONTINUE_WAIT_MS - (Date.now()-start);
        if(left<=0){ btnContinue.textContent="Continue"; btnContinue.disabled=false; clearInterval(timer); }
        else{ btnContinue.textContent=`Continue (${Math.ceil(left/1000)})`; }
      }, 200);
      btnContinue.onclick = onDone;
    }

    // Dashboard
    function showDashboard(){
      authCard.style.display='none'; warnCard.style.display='none'; dashCard.style.display='block';
    }

    // Keep UI synced (balance + cooldowns)
    function bindRealtime(u){
      // Balance
      onValue(ref(rtdb,`balances/${u.uid}`),(s)=>{
        const val = s.exists()? s.val():0; saldoEl.textContent = new Intl.NumberFormat('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}).format(val);
      });
      // Cooldowns + tick
      const cstate = { earn:0, bonus1:0, bonus2:0 };
      onValue(ref(rtdb,`cooldowns/${u.uid}`),(s)=>{
        const v = s.val()||{earn:0,bonus1:0,bonus2:0}; cstate.earn=v.earn||0; cstate.bonus1=v.bonus1||0; cstate.bonus2=v.bonus2||0;
      });
      (function loop(){
        const now = Date.now();
        setCooldownUI(btnEarn,   cstate.earn   - now);
        setCooldownUI(btnBonus1, cstate.bonus1 - now);
        setCooldownUI(btnBonus2, cstate.bonus2 - now);
        requestAnimationFrame(loop);
      })();
    }

    // Claim handler
    async function claim(u, key, adUrl){
      const cdRef = ref(rtdb, `cooldowns/${u.uid}/${key}`);
      const balRef = ref(rtdb, `balances/${u.uid}`);

      // Check cooldown atomically (two-step, still client-side)
      const cdSnap = await get(cdRef);
      const now = Date.now();
      const nextAt = (cdSnap.exists()? cdSnap.val():0);
      if(now < nextAt){ toast("Masih cooldown untuk tombol ini.","warn"); return; }

      if(adUrl && adUrl.startsWith("http")) window.open(adUrl, "_blank","noopener");

      // Increment balance atomically via transaction
      const newBalance = await runTransaction(balRef, (curr)=> (curr||0)+REWARD).then(r=>r.snapshot.val());

      // Write cooldown (client time; untuk anti-manipulasi penuh butuh server)
      await update(ref(rtdb,`cooldowns/${u.uid}`), { [key]: now + COOLDOWN_MS });

      // Mirror ke Firestore (profile + earnings log)
      await Promise.all([
        updateDoc(doc(fs,"users",u.uid), { balance: newBalance }),
        addDoc(collection(fs,"earnings"), { uid:u.uid, amount:REWARD, source:key, createdAt:serverTimestamp() })
      ]);

      toast(`Berhasil +${fmtIDR(REWARD)} ðŸŽ‰`, "ok");
    }

    // Auth state
    onAuthStateChanged(auth, async (u)=>{
      if(!u){ authCard.style.display='block'; warnCard.style.display='none'; dashCard.style.display='none'; return; }
      try{
        const ip = await ensureProfile(u);
        userEmailEl.textContent = u.email; ipChip.textContent = `IP: ${ip}`;
        // Warning 1x
        const prof = await getDoc(doc(fs,"users",u.uid));
        const warned = prof.exists() && prof.data().warnedOnce===true;
        if(!warned){
          showWarning(async ()=>{
            await updateDoc(doc(fs,"users",u.uid), { warnedOnce:true });
            showDashboard();
            bindRealtime(u);
          });
        }else{
          showDashboard();
          bindRealtime(u);
        }

        // Wire buttons
        btnEarn.onclick   = ()=> claim(u,'earn',MONETAG_URL);
        btnBonus1.onclick = ()=> claim(u,'bonus1',KLIK1_URL);
        btnBonus2.onclick = ()=> claim(u,'bonus2',KLIK2_URL);

      }catch(e){
        toast(e.message || "Terjadi kesalahan.","err");
        await signOut(auth);
      }
    });
  </script>

  <!-- ====== TARUH SCRIPT IKLANMU DI SINI (Monetag / KlikAdilla) ======
       Contoh (placeholder):
       <script src="https://YOUR-MONETAG-SNIPPET.js"></script>
       <script src="https://YOUR-KLIKADILLA-SNIPPET.js"></script>
  -->
</body>
</html>
