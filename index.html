<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>NusaTask - Bot Earning 1</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Font + Custom Style -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; }
    .btn { transition: all 0.3s ease; }
    .btn:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(0,255,150,0.4); }
    .disabled { background: #555 !important; cursor: not-allowed; }
    .toast {
      position: fixed; bottom: 20px; right: 20px;
      background: #1f2937; padding: 12px 18px;
      border-radius: 10px; color: #fff;
      opacity: 0; transform: translateY(20px);
      transition: all 0.4s ease;
    }
    .toast.show { opacity: 1; transform: translateY(0); }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white flex items-center justify-center min-h-screen">

<div class="w-[400px] bg-gray-800/70 backdrop-blur-md rounded-2xl shadow-2xl p-6 text-center">
  <h1 class="text-3xl font-bold mb-6 text-green-400">🎯 NusaTask Bot 1</h1>

  <!-- Loading -->
  <div id="loading" class="hidden text-blue-400 animate-pulse">⏳ Memproses...</div>

  <!-- Login -->
  <div id="loginForm">
    <input id="email" type="email" placeholder="Email" class="w-full p-2 mb-2 text-black rounded">
    <input id="password" type="password" placeholder="Password" class="w-full p-2 mb-2 text-black rounded">
    <button onclick="login()" class="btn bg-blue-500 w-full py-2 rounded mt-2">Login</button>
    <button onclick="register()" class="btn bg-green-500 w-full py-2 rounded mt-2">Register</button>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="hidden">
    <div class="bg-gray-900 rounded-xl p-4 shadow mb-4">
      <p id="saldo" class="text-2xl font-semibold">Saldo: Rp 0</p>
      <div class="w-full bg-gray-700 h-3 rounded mt-3 overflow-hidden">
        <div id="progressBar" class="bg-green-500 h-3 transition-all duration-500" style="width:0%"></div>
      </div>
      <p id="progress" class="text-sm text-gray-400 mt-2">Claim: 0/20</p>
    </div>

    <button id="rewardBtn" onclick="claimReward('reward')" class="btn w-full py-3 mt-2 rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 font-semibold">🎁 Ambil Reward</button>
    <button id="bonusBtn" onclick="claimReward('bonus')" class="btn w-full py-3 mt-3 rounded-xl bg-gradient-to-r from-yellow-400 to-amber-500 font-semibold">⭐ Xstra Bonus</button>

    <p id="cooldownText" class="text-red-400 mt-4"></p>
  </div>

  <!-- Pesan banned -->
  <div id="banned" class="hidden text-red-400 font-bold mt-6">
    🚫 Akun anda diblokir. Hubungi admin 👉 <a href="https://t.me/nusataskproject" class="underline">@nusataskproject</a>
  </div>
</div>

<!-- Toast Notifikasi -->
<div id="toast" class="toast">✅ Reward berhasil ditambahkan!</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
  import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // ✅ Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyCrFmaHbmL299cum51EtJIjt5NpukpTmho",
    authDomain: "penyimpanansaldo-280df.firebaseapp.com",
    databaseURL: "https://penyimpanansaldo-280df-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "penyimpanansaldo-280df",
    storageBucket: "penyimpanansaldo-280df.firebasestorage.app",
    messagingSenderId: "659609775130",
    appId: "1:659609775130:web:bdd088ca5a877498c5b5a3",
    measurementId: "G-L4TW7E23H2"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const BOT_KEY = "bot1";   // ubah ke bot2, bot3, dst untuk clone
  let currentUser, cooldown = 120000, maxClaim = 20;

  function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.innerText = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
  }

  async function register() {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    document.getElementById('loading').classList.remove("hidden");
    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, pass);
      currentUser = userCred.user;
      await set(ref(db, "users/" + currentUser.uid), {
        email: email,
        status: "active",
        bots: {
          [BOT_KEY]: { saldo: 0, claimedToday: 0, lastClaim: 0 }
        }
      });
      showToast("✅ Registrasi berhasil!");
      loadDashboard();
    } catch (e) {
      alert("❌ " + e.message);
    }
    document.getElementById('loading').classList.add("hidden");
  }

  async function login() {
    const email = document.getElementById('email').value;
    const pass = document.getElementById('password').value;
    document.getElementById('loading').classList.remove("hidden");
    try {
      const userCred = await signInWithEmailAndPassword(auth, email, pass);
      currentUser = userCred.user;
      loadDashboard();
    } catch (e) {
      alert("❌ " + e.message);
    }
    document.getElementById('loading').classList.add("hidden");
  }

  onAuthStateChanged(auth, (user) => { if (user) { currentUser = user; loadDashboard(); } });

  async function loadDashboard() {
    const snap = await get(ref(db, "users/" + currentUser.uid));
    if (!snap.exists()) return;
    const userData = snap.val();

    if (userData.status === "banned") {
      document.getElementById("loginForm").classList.add("hidden");
      document.getElementById("banned").classList.remove("hidden");
      return;
    }

    document.getElementById("loginForm").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    updateUI(userData.bots[BOT_KEY] || { saldo: 0, claimedToday: 0, lastClaim: 0 });
  }

  async function claimReward(type) {
    const snap = await get(ref(db, "users/" + currentUser.uid + "/bots/" + BOT_KEY));
    let data = snap.val() || { saldo: 0, claimedToday: 0, lastClaim: 0 };

    if (data.claimedToday >= maxClaim) {
      showToast("⚠️ Limit harian tercapai!");
      return;
    }

    const now = Date.now();
    if (now - data.lastClaim < cooldown) {
      document.getElementById("cooldownText").innerText = "⏳ Tunggu cooldown selesai!";
      return;
    }

    let reward = type === "reward" ? 500 : 1000;
    data.saldo += reward;
    data.claimedToday += 1;
    data.lastClaim = now;

    await update(ref(db, "users/" + currentUser.uid + "/bots/" + BOT_KEY), data);
    updateUI(data);
    showToast("✅ Reward berhasil ditambahkan!");
  }

  function updateUI(data) {
    document.getElementById("saldo").innerText = "Saldo: Rp " + data.saldo;
    document.getElementById("progress").innerText = "Claim: " + data.claimedToday + "/" + maxClaim;
    document.getElementById("progressBar").style.width = (data.claimedToday / maxClaim * 100) + "%";
    document.getElementById("cooldownText").innerText = "";
  }
</script>
</body>
</html>